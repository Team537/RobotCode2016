#include <DriveTrain.hpp>

void DriveTrain::Drive (Joystick *Joy)
{
	CurrentSpeedLeft = Joy->GetRawAxis(LEFT_AXIS);
	CurrentSpeedRight = Joy->GetRawAxis(RIGHT_AXIS);
	if (fabs(CurrentSpeedLeft) < JOYSTICK_DEADBAND)
	{
		CurrentSpeedLeft = 0;
	}
	if (fabs(CurrentSpeedRight) < JOYSTICK_DEADBAND)
	{
		CurrentSpeedRight = 0;
	}
	DeltaSpeedLeft = CurrentSpeedLeft - OldSpeedLeft;
	DeltaSpeedLeft = CurrentSpeedRight - OldSpeedRight;
	LeftSign = CurrentSpeedLeft/fabs(CurrentSpeedLeft);
	RightSign = CurrentSpeedRight/fabs(CurrentSpeedRight);
	if (fabs(DeltaSpeedLeft) > RAMP_SPEED)
	{
		CurrentSpeedLeft = OldSpeedLeft + LeftSign*RAMP_SPEED;
	}
	if (fabs(DeltaSpeedRight) > RAMP_SPEED)
	{
		CurrentSpeedRight = OldSpeedRight + RightSign*RAMP_SPEED;
	}
	if (fabs(CurrentSpeedLeft) > 1)
	{
		CurrentSpeedLeft = LeftSign;
	}
	if (fabs(CurrentSpeedRight) > 1)
	{
		CurrentSpeedRight = RightSign;
	}
	OldSpeedLeft = CurrentSpeedLeft;
	OldSpeedRight = CurrentSpeedRight;
	LeftDrive->SetSpeed(CurrentSpeedLeft);
	RightDrive->SetSpeed(CurrentSpeedRight);
}
