#include <Shooter/ShooterManager.hpp>

void ShooterManager::Update(bool teleop)
{
	if (activateButton->WasDown())
	{
		activated = !activated;
	}

	if (activated && drive->GetState() != SHOOTER_TELOPERATION)
	{
		drive->ChangeState(SHOOTER_TELOPERATION);
	}

	if (activated && drive->OnTargetAngle())
	{
		activated = false;
	}
}

void ShooterManager::Init()
{
	if (Piston->Get())
	{
		Piston->Set(false);
	}
}

void ShooterManager::Dashboard()
{
	SmartDashboard::PutBoolean("Shooter Activated", activated);
}

void ShooterManager::Auto()
{
	if (drive->OnTargetAngle())
	{
		Fire();
	}
}

void ShooterManager::Manual()
{
	if (activateButton->GetState() && !activateButton->WasDown())
	{
		Fire();
	}
}

void ShooterManager::Fire()
{
	switch (State)
	{
	case 0:
		leftMotor->Set(speed);
		break;
	case 1:
		if (fabs(leftMotor->GetSpeed() - speed) <= tolerance)
		{
			Piston->Set(true);
			State++;
		}
		break;
	case 2:
		Piston->Set(false);
		leftMotor->Set(0);
		State = 0;
		break;
	}
}
